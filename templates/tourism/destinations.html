{% extends 'base.html' %}
{% load static %}
{% load destination_extras %}

{% block title %}All Destinations - Smart Tourism India{% endblock %}

{% block content %}
<!-- Hero Section with Video Background -->
<section class="page-hero-section destinations-hero" id="destinations-hero">
    <!-- Video Background -->
    <div class="page-hero-video">
        <video autoplay muted loop playsinline class="destinations-video">
            <source src="{% static 'videos/destinations-bg.mp4' %}" type="video/mp4">
            <source src="{% static 'videos/destinations-bg.webm' %}" type="video/webm">
        </video>
        <img src="{% static 'images/backgrounds/destinations-bg.jpg' %}" alt="Mountains Background" class="page-hero-video-fallback">
    </div>
    
    <div class="page-hero-content">
        <h1 class="page-hero-title">
            <i class="fas fa-mountain me-3"></i>
            Discover Amazing Destinations
        </h1>
        <p class="page-hero-subtitle">
            Explore India's most beautiful and iconic places - from majestic mountains to pristine beaches
        </p>
    </div>
</section>

<div class="container-fluid py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h1 class="mb-4">
                    <i class="fas fa-mountain me-2"></i>
                    Discover Amazing Destinations
                </h1>
                
                <!-- Search and Filters -->
                <div class="card mb-4">
                    <div class="card-body">
                        <form method="get" class="row g-3">
                            <div class="col-md-4">
                                <input type="text" name="search" class="form-control" 
                                       placeholder="Search destinations..." value="{{ search_query }}">
                            </div>
                            <div class="col-md-2">
                                <select name="category" class="form-select">
                                    <option value="">All Categories</option>
                                    {% for category in categories %}
                                        <option value="{{ category.name }}" 
                                                {% if selected_category == category.name %}selected{% endif %}>
                                            {{ category.get_name_display }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-2">
                                <select name="state" class="form-select">
                                    <option value="">All States</option>
                                    {% for state in states %}
                                        <option value="{{ state.name }}" 
                                                {% if selected_state == state.name %}selected{% endif %}>
                                            {{ state.name }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-2">
                                <select name="rating" class="form-select">
                                    <option value="">Any Rating</option>
                                    <option value="4.5" {% if selected_rating == '4.5' %}selected{% endif %}>4.5+ Stars</option>
                                    <option value="4.0" {% if selected_rating == '4.0' %}selected{% endif %}>4.0+ Stars</option>
                                    <option value="3.5" {% if selected_rating == '3.5' %}selected{% endif %}>3.5+ Stars</option>
                                </select>
                            </div>
                            <div class="col-md-1 d-flex align-items-center justify-content-center">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="featured" value="1" id="id_featured" 
                                           {% if selected_featured == '1' or selected_featured == 'true' %}checked{% endif %}>
                                    <label class="form-check-label" for="id_featured" title="Featured Destinations Only">
                                        ðŸŒŸ
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-1">
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Results Count -->
                <div class="mb-3">
                    <p class="text-muted">
                        Found {{ destinations|length }} {% if selected_featured == '1' or selected_featured == 'true' %}<span class="text-warning"><i class="fas fa-star"></i> featured</span> {% endif %}destination{{ destinations|length|pluralize }}
                        {% if search_query %}for "{{ search_query }}"{% endif %}
                    </p>
                </div>
                
                <!-- Destinations Grid -->
                <div class="row">
                    {% for destination in destinations %}
                        {% destination_card destination show_description=True %}
                    {% empty %}
                        <div class="col-12">
                            <div class="alert alert-info text-center">
                                <h4><i class="fas fa-info-circle"></i> No destinations found</h4>
                                <p>Try adjusting your search filters or <a href="{% url 'tourism:destinations' %}">view all destinations</a>.</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                <!-- Pagination -->
                {% if is_paginated %}
                    <nav aria-label="Destinations pagination">
                        <ul class="pagination justify-content-center">
                            {% if page_obj.has_previous %}
                                <li class="page-item">
                                    <a class="page-link" href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.state %}&state={{ request.GET.state }}{% endif %}{% if request.GET.rating %}&rating={{ request.GET.rating }}{% endif %}{% if request.GET.featured %}&featured={{ request.GET.featured }}{% endif %}">First</a>
                                </li>
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.state %}&state={{ request.GET.state }}{% endif %}{% if request.GET.rating %}&rating={{ request.GET.rating }}{% endif %}{% if request.GET.featured %}&featured={{ request.GET.featured }}{% endif %}">Previous</a>
                                </li>
                            {% endif %}
                            
                            <li class="page-item active">
                                <span class="page-link">{{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
                            </li>
                            
                            {% if page_obj.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.state %}&state={{ request.GET.state }}{% endif %}{% if request.GET.rating %}&rating={{ request.GET.rating }}{% endif %}{% if request.GET.featured %}&featured={{ request.GET.featured }}{% endif %}">Next</a>
                                </li>
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.state %}&state={{ request.GET.state }}{% endif %}{% if request.GET.rating %}&rating={{ request.GET.rating }}{% endif %}{% if request.GET.featured %}&featured={{ request.GET.featured }}{% endif %}">Last</a>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
.destination-card {
    transition: transform 0.2s;
}

.destination-card:hover {
    transform: translateY(-5px);
}
</style>
{% endblock %}