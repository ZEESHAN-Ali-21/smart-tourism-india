{% extends 'base.html' %}
{% load static %}

{% block title %}Interactive Maps - Smart Tourism India{% endblock %}

{% block extra_css %}
<!-- Enhanced 3D Interactive Maps with Mapbox GL JS -->

<style>
    .map-container {
        position: relative;
        height: 70vh;
        min-height: 500px;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    
    .map-loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        z-index: 1000;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .destination-legend {
        background: white;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-top: 20px;
    }
    
    .legend-item {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
    }
    
    .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        margin-right: 10px;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        text-align: center;
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section with Video Background -->
<section class="page-hero-section maps-hero" id="maps-hero">
    <!-- Video Background -->
    <div class="page-hero-video">
        <video autoplay muted loop playsinline class="maps-video">
            <source src="{% static 'videos/maps-bg.mp4' %}" type="video/mp4">
            <source src="{% static 'videos/maps-bg.webm' %}" type="video/webm">
        </video>
        <img src="{% static 'images/backgrounds/maps-bg.jpg' %}" alt="Aerial View Background" class="page-hero-video-fallback">
    </div>
    
    <div class="page-hero-content">
        <h1 class="page-hero-title">
            <i class="fas fa-globe me-3"></i>
            Interactive Maps
        </h1>
        <p class="page-hero-subtitle">
            Explore destinations across India with our interactive map - discover hidden gems and plan your perfect journey
        </p>
    </div>
</section>
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="text-center">
                <h1 class="display-4 mb-3">
                    <i class="fas fa-map-marked-alt text-primary me-3"></i>
                    Interactive Maps
                </h1>
                <p class="lead text-muted">
                    Explore all destinations across India with real-time weather and location data
                </p>
            </div>
        </div>
    </div>
    
    <!-- Stats Cards -->
    <div class="stats-grid mb-4">
        <div class="stat-card">
            <h3 class="text-primary mb-0" id="total-destinations">{{ total_destinations }}</h3>
            <p class="text-muted mb-0">Total Destinations</p>
        </div>
        <div class="stat-card">
            <h3 class="text-success mb-0" id="featured-destinations">{{ featured_destinations }}</h3>
            <p class="text-muted mb-0">Featured Destinations</p>
        </div>
        <div class="stat-card">
            <h3 class="text-info mb-0" id="states-covered">{{ states_covered }}</h3>
            <p class="text-muted mb-0">States Covered</p>
        </div>
        <div class="stat-card">
            <h3 class="text-warning mb-0">8</h3>
            <p class="text-muted mb-0">Categories</p>
        </div>
    </div>
    
    <!-- Map and Controls Row -->
    <div class="row">
        <!-- Map -->
        <div class="col-lg-9 mb-4">
            <div class="map-container">
                <!-- Loading Indicator -->
                <div class="map-loading" id="mapLoading">
                    <div class="spinner-border text-primary mb-3" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h5>Loading Interactive Map...</h5>
                    <p class="text-muted mb-0">Fetching destinations and initializing map</p>
                </div>
                
                <!-- Error State -->
                <div class="map-error" id="mapError">
                    <div class="text-danger mb-3">
                        <i class="fas fa-exclamation-triangle fa-3x"></i>
                    </div>
                    <h5 class="text-danger mb-3">Oops! Something went wrong.</h5>
                    <p class="text-muted mb-3">
                        This page didn't load Google Maps correctly. Please check:
                    </p>
                    <ul class="text-start text-muted mb-3">
                        <li>Your internet connection</li>
                        <li>Google Maps API configuration</li>
                        <li>Browser JavaScript is enabled</li>
                    </ul>
                    <button class="btn btn-primary" onclick="location.reload()">
                        <i class="fas fa-sync-alt me-2"></i>Try Again
                    </button>
                </div>
                
                <!-- Google Map -->
                <div id="map" style="height: 100%; width: 100%;"></div>
                
                <!-- Map Controls -->
                <div class="map-controls">
                    <h6 class="mb-3">
                        <i class="fas fa-filter me-2"></i>Filter Destinations
                    </h6>
                    
                    <!-- Category Filter -->
                    <div class="mb-3">
                        <select class="form-select form-select-sm" id="categoryFilter">
                            <option value="">All Categories</option>
                            <option value="eco">Eco Tourism</option>
                            <option value="cultural">Cultural</option>
                            <option value="religious">Religious</option>
                            <option value="adventure">Adventure</option>
                            <option value="historical">Historical</option>
                            <option value="wildlife">Wildlife</option>
                            <option value="beach">Beach</option>
                            <option value="mountain">Mountain</option>
                        </select>
                    </div>
                    
                    <!-- State Filter -->
                    <div class="mb-3">
                        <select class="form-select form-select-sm" id="stateFilter">
                            <option value="">All States</option>
                            {% for state in states %}
                                <option value="{{ state.id }}">{{ state.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <!-- Rating Filter -->
                    <div class="mb-3">
                        <label class="form-label small">Minimum Rating</label>
                        <select class="form-select form-select-sm" id="ratingFilter">
                            <option value="0">All Ratings</option>
                            <option value="3">3+ Stars</option>
                            <option value="4">4+ Stars</option>
                            <option value="4.5">4.5+ Stars</option>
                        </select>
                    </div>
                    
                    <!-- Featured Only -->
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="featuredOnly">
                        <label class="form-check-label small" for="featuredOnly">
                            Featured Only
                        </label>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary btn-sm" onclick="applyFilters()">
                            <i class="fas fa-search me-1"></i>Apply Filters
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="resetFilters()">
                            <i class="fas fa-times me-1"></i>Clear Filters
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Legend and Info -->
        <div class="col-lg-3">
            <!-- Category Legend -->
            <div class="destination-legend">
                <h6 class="mb-3">
                    <i class="fas fa-map-pin me-2"></i>Destination Categories
                </h6>
                <div class="legend-item">
                    <div class="legend-color" style="background: #2ecc71;"></div>
                    <small>Eco Tourism</small>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #9b59b6;"></div>
                    <small>Cultural</small>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f1c40f;"></div>
                    <small>Religious</small>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e67e22;"></div>
                    <small>Adventure</small>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #8b4513;"></div>
                    <small>Historical</small>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #27ae60;"></div>
                    <small>Wildlife</small>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #3498db;"></div>
                    <small>Beach</small>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #87ceeb;"></div>
                    <small>Mountain</small>
                </div>
            </div>
            
            <!-- Map Info -->
            <div class="destination-legend mt-3">
                <h6 class="mb-3">
                    <i class="fas fa-info-circle me-2"></i>Map Features
                </h6>
                <ul class="list-unstyled">
                    <li class="mb-2">
                        <i class="fas fa-map-marker-alt text-primary me-2"></i>
                        <small>Click markers for details</small>
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-directions text-success me-2"></i>
                        <small>Get directions to destinations</small>
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-cloud-sun text-info me-2"></i>
                        <small>Real-time weather data</small>
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-filter text-warning me-2"></i>
                        <small>Filter by category & rating</small>
                    </li>
                </ul>
            </div>
            
            <!-- Quick Actions -->
            <div class="destination-legend mt-3">
                <h6 class="mb-3">
                    <i class="fas fa-rocket me-2"></i>Quick Actions
                </h6>
                <div class="d-grid gap-2">
                    <a href="{% url 'tourism:destinations' %}" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-list me-1"></i>All Destinations
                    </a>
                    <a href="{% url 'chatbot:chat' %}" class="btn btn-outline-success btn-sm">
                        <i class="fas fa-robot me-1"></i>AI Assistant
                    </a>
                    {% if user.is_authenticated %}
                        <a href="{% url 'tourism:trip_list' %}" class="btn btn-outline-info btn-sm">
                            <i class="fas fa-route me-1"></i>My Trips
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Enhanced 3D Interactive Maps with Mapbox GL JS
// Global variables for 3D map
let interactiveMap;
let allDestinations = [];
let filteredDestinations = [];
let mapLoaded = false;
let currentMarkers = [];

// Initialize 3D Mapbox map
function initializeMap() {
    try {
        console.log('Initializing enhanced 3D interactive map...');
        
        // Check if mapboxUtils is available
        if (typeof mapboxUtils === 'undefined') {
            console.error('MapboxUtils is not loaded!');
            setTimeout(initializeMap, 500); // Retry after 500ms
            return;
        }
        
        // Hide loading, show map
        document.getElementById('mapLoading').style.display = 'none';
        
        // Initialize 3D Mapbox map with enhanced settings
        interactiveMap = mapboxUtils.initMap('map', {
            center: [78.9629, 20.5937], // Center of India [lng, lat]
            zoom: 4.5,
            pitch: 45, // 3D angle for dramatic effect
            bearing: 0,
            antialias: true
        });
        
        // Wait for map to fully load
        interactiveMap.on('load', () => {
            console.log('3D Map initialized successfully with terrain and buildings');
            mapLoaded = true;
            loadDestinations();
            
            // Add enhanced map controls
            addInteractiveMapControls();
        });
        
    } catch (error) {
        console.error('Error initializing 3D map:', error);
        showMapError();
    }
}

// Add interactive map controls
function addInteractiveMapControls() {
    // Add measurement control
    const measureControl = {
        onAdd: (map) => {
            const div = document.createElement('div');
            div.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';
            div.innerHTML = `
                <button type="button" class="mapboxgl-ctrl-icon" title="Measure Distance">
                    <i class="fas fa-ruler"></i>
                </button>
            `;
            return div;
        },
        onRemove: () => {}
    };
    
    interactiveMap.addControl(measureControl, 'top-right');
    
    // Add layer visibility toggle
    const layerToggleControl = {
        onAdd: (map) => {
            const div = document.createElement('div');
            div.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';
            div.innerHTML = `
                <button type="button" class="mapboxgl-ctrl-icon" id="toggleTerrain" title="Toggle 3D Terrain">
                    <i class="fas fa-mountain"></i>
                </button>
            `;
            
            div.querySelector('#toggleTerrain').addEventListener('click', () => {
                mapboxUtils.toggle3D();
            });
            
            return div;
        },
        onRemove: () => {}
    };
    
    interactiveMap.addControl(layerToggleControl, 'top-right');
}

// Show error state
function showMapError() {
    document.getElementById('mapLoading').style.display = 'none';
    document.getElementById('mapError').style.display = 'block';
}

// Load destinations data with enhanced 3D visualization
function loadDestinations() {
    try {
        // Real destinations data from Django template context
        allDestinations = [
            {% for destination in destinations %}
            {% if destination.latitude and destination.longitude %}
            {
                name: "{{ destination.name|escapejs }}",
                latitude: {{ destination.latitude }},
                longitude: {{ destination.longitude }},
                city: "{{ destination.city|escapejs }}",
                state: {name: "{{ destination.state.name|escapejs }}", id: {{ destination.state.id }}},
                short_description: "{{ destination.short_description|escapejs }}",
                description: "{{ destination.description|truncatewords:20|escapejs }}",
                average_rating: {{ destination.average_rating|default:0 }},
                slug: "{{ destination.slug }}",
                featured: {{ destination.featured|yesno:"true,false" }},
                categories: [{% for cat in destination.categories.all %}{name: "{{ cat.name }}"}{% if not forloop.last %},{% endif %}{% endfor %}]
            }{% if not forloop.last %},{% endif %}
            {% endif %}
            {% endfor %}
        ];
        
        filteredDestinations = [...allDestinations];
        
        // Update stats
        updateStats();
        
        // Show destinations on 3D map with enhanced markers
        if (mapLoaded && interactiveMap) {
            showDestinationsOnMap3D(filteredDestinations);
        }
    } catch (error) {
        console.error('Error loading destinations:', error);
        showMapError();
    }
}

// Enhanced 3D destination visualization
function showDestinationsOnMap3D(destinations) {
    // Clear existing markers
    currentMarkers.forEach(marker => marker.remove());
    currentMarkers = [];
    
    if (!destinations || destinations.length === 0) return;
    
    const bounds = new mapboxgl.LngLatBounds();
    
    destinations.forEach((destination, index) => {
        const coordinates = [destination.longitude, destination.latitude];
        
        // Category colors for enhanced visualization
        const categoryColors = {
            'eco': ['#2ecc71', '#27ae60'],
            'cultural': ['#9b59b6', '#8e44ad'],
            'religious': ['#f1c40f', '#f39c12'],
            'adventure': ['#e67e22', '#d35400'],
            'historical': ['#8b4513', '#654321'],
            'wildlife': ['#27ae60', '#229954'],
            'beach': ['#3498db', '#2980b9'],
            'mountain': ['#87ceeb', '#5dade2']
        };
        
        const firstCategory = destination.categories && destination.categories.length > 0 ? 
            destination.categories[0].name : 'default';
        const colors = categoryColors[firstCategory] || ['#e74c3c', '#c0392b'];
        
        // Create enhanced 3D marker
        const markerEl = document.createElement('div');
        markerEl.className = 'interactive-3d-marker';
        markerEl.style.cssText = `
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, ${colors[0]}, ${colors[1]});
            border: 4px solid white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
            font-weight: bold;
            position: relative;
            animation: marker3DFloat 3s ease-in-out infinite;
            transition: all 0.3s ease;
        `;
        
        // Add category icon
        const categoryIcons = {
            'eco': '🌿', 'cultural': '🏛️', 'religious': '🕉️', 'adventure': '🏔️',
            'historical': '🏺', 'wildlife': '🦁', 'beach': '🏖️', 'mountain': '⛰️'
        };
        markerEl.innerHTML = categoryIcons[firstCategory] || '📍';
        
        // Add featured star
        if (destination.featured) {
            const star = document.createElement('div');
            star.innerHTML = '⭐';
            star.style.cssText = `
                position: absolute;
                top: -8px;
                right: -8px;
                background: #ffd700;
                border-radius: 50%;
                width: 18px;
                height: 18px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 10px;
                animation: starTwinkle 2s infinite;
            `;
            markerEl.appendChild(star);
        }
        
        // Enhanced hover effects
        markerEl.addEventListener('mouseenter', () => {
            markerEl.style.transform = 'scale(1.2)';
            markerEl.style.zIndex = '1000';
        });
        markerEl.addEventListener('mouseleave', () => {
            markerEl.style.transform = 'scale(1)';
            markerEl.style.zIndex = 'auto';
        });
        
        // Create Mapbox marker
        const marker = new mapboxgl.Marker(markerEl)
            .setLngLat(coordinates)
            .addTo(interactiveMap);
        
        // Enhanced popup with 3D styling
        const popupContent = `
            <div class="interactive-popup-3d">
                <div class="popup-header-3d">
                    <h6 class="fw-bold text-primary mb-1">${destination.name}</h6>
                    <div class="rating-display-3d">
                        ${'⭐'.repeat(Math.floor(destination.average_rating || 0))}${'☆'.repeat(5-Math.floor(destination.average_rating || 0))}
                        <span class="rating-text ms-1">(${(destination.average_rating || 0).toFixed(1)})</span>
                    </div>
                </div>
                <p class="location-3d"><i class="fas fa-map-marker-alt text-danger"></i> ${destination.city}, ${destination.state.name}</p>
                <p class="description-3d">${destination.short_description || destination.description}</p>
                <div class="action-buttons-3d">
                    <a href="/destinations/${destination.slug}/" class="btn btn-primary btn-sm">
                        <i class="fas fa-info-circle"></i> Explore
                    </a>
                    <button onclick="focusOn3DDestination(${destination.longitude}, ${destination.latitude})" class="btn btn-success btn-sm">
                        <i class="fas fa-cube"></i> 3D View
                    </button>
                    <button onclick="getDirections3D(${destination.longitude}, ${destination.latitude})" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-directions"></i> Directions
                    </button>
                </div>
            </div>
        `;
        
        const popup = new mapboxgl.Popup({
            offset: 30,
            closeButton: true,
            closeOnClick: false,
            className: 'interactive-3d-popup'
        }).setHTML(popupContent);
        
        marker.setPopup(popup);
        currentMarkers.push(marker);
        bounds.extend(coordinates);
    });
    
    // Fit map to show all markers with 3D perspective
    if (destinations.length > 0) {
        interactiveMap.fitBounds(bounds, {
            padding: { top: 80, bottom: 80, left: 80, right: 80 },
            pitch: 45,
            bearing: 0,
            maxZoom: 12
        });
    }
    
    // Add CSS animations
    const style = document.createElement('style');
    style.textContent = `
        @keyframes marker3DFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }
        @keyframes starTwinkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }
        .interactive-popup-3d {
            font-family: 'Inter', sans-serif;
            max-width: 280px;
        }
        .popup-header-3d {
            margin-bottom: 10px;
        }
        .rating-display-3d {
            color: #f39c12;
            font-size: 14px;
        }
        .rating-text {
            color: #7f8c8d;
            font-size: 12px;
        }
        .location-3d {
            color: #e74c3c;
            font-size: 13px;
            margin-bottom: 8px;
        }
        .description-3d {
            font-size: 12px;
            color: #34495e;
            margin-bottom: 12px;
            line-height: 1.4;
        }
        .action-buttons-3d {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }
        .action-buttons-3d .btn {
            font-size: 11px;
            padding: 4px 8px;
        }
    `;
    document.head.appendChild(style);
}

// Update statistics with animation
function updateStats() {
    const totalDestinations = allDestinations.length;
    const featuredDestinations = allDestinations.filter(d => d.featured).length;
    const statesSet = new Set(allDestinations.map(d => d.state?.name).filter(Boolean));
    
    // Animate numbers
    animateNumber('total-destinations', totalDestinations);
    animateNumber('featured-destinations', featuredDestinations);
    animateNumber('states-covered', statesSet.size);
}

// Animate number changes
function animateNumber(elementId, targetNumber) {
    const element = document.getElementById(elementId);
    const startNumber = parseInt(element.textContent) || 0;
    const duration = 1000;
    const startTime = Date.now();
    
    function update() {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const currentNumber = Math.floor(startNumber + (targetNumber - startNumber) * progress);
        
        element.textContent = currentNumber;
        
        if (progress < 1) {
            requestAnimationFrame(update);
        }
    }
    
    requestAnimationFrame(update);
}

// Enhanced filter system with 3D updates
function applyFilters() {
    const categoryFilter = document.getElementById('categoryFilter').value;
    const stateFilter = document.getElementById('stateFilter').value;
    const ratingFilter = parseFloat(document.getElementById('ratingFilter').value) || 0;
    const featuredOnly = document.getElementById('featuredOnly') ? document.getElementById('featuredOnly').checked : false;
    
    filteredDestinations = allDestinations.filter(destination => {
        if (categoryFilter && !destination.categories.some(cat => cat.name === categoryFilter)) {
            return false;
        }
        if (stateFilter && destination.state?.id != stateFilter) {
            return false;
        }
        if (ratingFilter > 0 && parseFloat(destination.average_rating) < ratingFilter) {
            return false;
        }
        if (featuredOnly && !destination.featured) {
            return false;
        }
        return true;
    });
    
    // Update 3D map with filtered results
    if (mapLoaded && interactiveMap) {
        showDestinationsOnMap3D(filteredDestinations);
    }
    
    showToast3D(`Found ${filteredDestinations.length} destinations matching your filters`);
}

// Reset filters with smooth animation
function resetFilters() {
    document.getElementById('categoryFilter').value = '';
    document.getElementById('stateFilter').value = '';
    document.getElementById('ratingFilter').value = '0';
    if (document.getElementById('featuredOnly')) {
        document.getElementById('featuredOnly').checked = false;
    }
    
    filteredDestinations = [...allDestinations];
    
    if (mapLoaded && interactiveMap) {
        showDestinationsOnMap3D(filteredDestinations);
    }
    
    showToast3D('Filters cleared - showing all destinations');
}

// Enhanced 3D functions for interactive map
function focusOn3DDestination(lng, lat) {
    interactiveMap.flyTo({
        center: [lng, lat],
        zoom: 16,
        pitch: 75, // Very steep angle for dramatic effect
        bearing: Math.random() * 360, // Random rotation
        duration: 3000
    });
}

function getDirections3D(lng, lat) {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            (position) => {
                const userLng = position.coords.longitude;
                const userLat = position.coords.latitude;
                const directionsUrl = `https://www.google.com/maps/dir/${userLat},${userLng}/${lat},${lng}`;
                window.open(directionsUrl, '_blank');
            },
            () => {
                const directionsUrl = `https://www.google.com/maps/dir//${lat},${lng}`;
                window.open(directionsUrl, '_blank');
            }
        );
    } else {
        const directionsUrl = `https://www.google.com/maps/dir//${lat},${lng}`;
        window.open(directionsUrl, '_blank');
    }
}

// Enhanced 3D toast notifications
function showToast3D(message) {
    const toast = document.createElement('div');
    toast.className = 'toast-3d-notification';
    toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #007bff, #0056b3);
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
        z-index: 9999;
        box-shadow: 0 8px 25px rgba(0,123,255,0.3);
        transform: translateX(400px) rotateY(90deg);
        transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        font-family: 'Inter', sans-serif;
        font-weight: 500;
        border: 2px solid rgba(255,255,255,0.2);
    `;
    toast.innerHTML = `<i class="fas fa-cube me-2"></i>${message}`;
    
    document.body.appendChild(toast);
    
    // Show toast with 3D animation
    setTimeout(() => {
        toast.style.transform = 'translateX(0) rotateY(0deg)';
    }, 100);
    
    // Hide and remove toast
    setTimeout(() => {
        toast.style.transform = 'translateX(400px) rotateY(-90deg)';
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 500);
    }, 4000);
}

// Initialize enhanced 3D interactive map
document.addEventListener('DOMContentLoaded', function() {
    // Setup filter event listeners
    const categoryFilter = document.getElementById('categoryFilter');
    const stateFilter = document.getElementById('stateFilter');
    const ratingFilter = document.getElementById('ratingFilter');
    
    if (categoryFilter) categoryFilter.addEventListener('change', applyFilters);
    if (stateFilter) stateFilter.addEventListener('change', applyFilters);
    if (ratingFilter) ratingFilter.addEventListener('change', applyFilters);
    
    // Initialize map with slight delay for mapboxUtils to load
    setTimeout(() => {
        initializeMap();
    }, 200);
    
    console.log('Enhanced 3D Interactive Maps initialized!');
});

// Global exports for compatibility
window.initializeMap = initializeMap;
window.applyFilters = applyFilters;
window.resetFilters = resetFilters;
window.focusOn3DDestination = focusOn3DDestination;
window.getDirections3D = getDirections3D;
window.showToast3D = showToast3D;
</script>

{% endblock %}